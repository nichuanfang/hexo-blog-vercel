window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;Fluid.utils={listenScroll:function(e){var t=new Debouncer(e);window.addEventListener("scroll",t,false);t.handleEvent();var n=new Debouncer(()=>{const e={position:window.scrollY,timestamp:Date.now()};localStorage.setItem(`fluid_scroll_${window.location.pathname}`,JSON.stringify(e))});window.addEventListener("scroll",n,false);return t},unlistenScroll:function(e){window.removeEventListener("scroll",e)},listenDOMLoaded(i){const e=()=>{const t=`fluid_scroll_${window.location.pathname}`;const e=localStorage.getItem(t);if(e){try{const n=JSON.parse(e);if(Date.now()-n.timestamp<24*60*60*1e3){document.body.style.minHeight=`${n.position+window.innerHeight}px`;this.scrollToElement("body",n.position);const o=()=>{if(document.documentElement.scrollHeight<=n.position+window.innerHeight){setTimeout(o,200)}else{document.body.style.minHeight="";this.scrollToElement("body",n.position)}};setTimeout(o,200)}else{localStorage.removeItem(t)}}catch(e){localStorage.removeItem(t)}}i()};if(document.readyState!=="loading"){e()}else{document.addEventListener("DOMContentLoaded",e)}},scrollToElement:function(e,t){if(typeof t==="number"){window.scrollTo({top:t,behavior:"auto"});requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"auto"});setTimeout(()=>{window.scrollTo({top:t,behavior:"auto"})},150)});return}var n=jQuery(e).offset();if(n){jQuery("html,body").animate({scrollTop:n.top+(t||0),easing:"swing"})}},elementVisible:function(e,t){t=t&&t>=0?t:0;var n=e.getBoundingClientRect();const o=window.innerHeight||document.documentElement.clientHeight;return n.top>=0&&n.top<=o*(1+t)+n.height/2||n.bottom>=0&&n.bottom<=o*(1+t)+n.height/2},waitElementVisible:function(e,o,i){var t=typeof window!=="undefined";var n=t&&!("onscroll"in window)||typeof navigator!=="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);if(!t||n){return}i=i&&i>=0?i:0;function r(n){Fluid.utils.listenDOMLoaded(function(){if(Fluid.utils.elementVisible(n,i)){o();return}if("IntersectionObserver"in window){var e=new IntersectionObserver(function(e,t){if(e[0].isIntersecting){o();t.disconnect()}},{threshold:[0],rootMargin:(window.innerHeight||document.documentElement.clientHeight)*i+"px"});e.observe(n)}else{var t=Fluid.utils.listenScroll(function(){if(Fluid.utils.elementVisible(n,i)){Fluid.utils.unlistenScroll(t);o()}})}})}if(typeof e==="string"){this.waitElementLoaded(e,function(e){r(e)})}else{r(e)}},waitElementLoaded:function(o,i){var e=typeof window!=="undefined";var t=e&&!("onscroll"in window)||typeof navigator!=="undefined"&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);if(!e||t){return}if("MutationObserver"in window){var n=new MutationObserver(function(e,t){var n=document.querySelector(o);if(n){i(n);t.disconnect()}});n.observe(document,{childList:true,subtree:true})}else{Fluid.utils.listenDOMLoaded(function(){var t=function(){var e=document.querySelector(o);if(e){i(e)}else{setTimeout(t,100)}};t()})}},createScript:function(e,t){var n=document.createElement("script");n.setAttribute("src",e);n.setAttribute("type","text/javascript");n.setAttribute("charset","UTF-8");n.async=false;if(typeof t==="function"){if(window.attachEvent){n.onreadystatechange=function(){var e=n.readyState;if(e==="loaded"||e==="complete"){n.onreadystatechange=null;t()}}}else{n.onload=t}}var o=document.getElementsByTagName("script");var i=o.length>0?o[o.length-1]:document.head||document.documentElement;i.parentNode.insertBefore(n,i.nextSibling)},createCssLink:function(e){var t=document.createElement("link");t.setAttribute("rel","stylesheet");t.setAttribute("type","text/css");t.setAttribute("href",e);var n=document.getElementsByTagName("link")[0]||document.getElementsByTagName("head")[0]||document.head||document.documentElement;n.parentNode.insertBefore(t,n)},loadComments:function(e,t){var n=document.querySelector("#comments[lazyload]");if(n){var o=function(){t();n.removeAttribute("lazyload")};Fluid.utils.waitElementVisible(e,o,CONFIG.lazyload.offset_factor)}else{t()}},getBackgroundLightness(e){var t=e;if(typeof e==="string"){t=document.querySelector(e)}var n=t.ownerDocument.defaultView;if(!n){n=window}var o=n.getComputedStyle(t).backgroundColor.replace(/rgba*\(/,"").replace(")","").split(/,\s*/);if(o.length<3){return 0}var i=.213*o[0]+.715*o[1]+.072*o[2];return i===0||i>255/2?1:-1},retry(e,t,n){if(n<=0){return}var o=function(){if(--n>=0&&!e()){setTimeout(o,t)}};setTimeout(o,t)}};function Debouncer(e){this.callback=e;this.ticking=false}Debouncer.prototype={constructor:Debouncer,update:function(){this.callback&&this.callback();this.ticking=false},requestTick:function(){if(!this.ticking){requestAnimationFrame(this.rafCallback||(this.rafCallback=this.update.bind(this)));this.ticking=true}},handleEvent:function(){this.requestTick()}};window.addEventListener("beforeunload",()=>{const e={position:window.scrollY,timestamp:Date.now()};localStorage.setItem(`fluid_scroll_${window.location.pathname}`,JSON.stringify(e))});document.addEventListener("pjax:complete",()=>{const t=`fluid_scroll_${window.location.pathname}`;const e=localStorage.getItem(t);if(e){try{const n=JSON.parse(e);if(Date.now()-n.timestamp<24*60*60*1e3){Fluid.utils.scrollToElement("body",n.position)}}catch(e){localStorage.removeItem(t)}}});function cleanupScrollData(){const e=Object.keys(localStorage);const t=e.filter(e=>e.startsWith("fluid_scroll_"));const n=Date.now();const o=24*60*60*1e3;t.forEach(t=>{try{const e=JSON.parse(localStorage.getItem(t));if(n-e.timestamp>o){localStorage.removeItem(t)}}catch(e){localStorage.removeItem(t)}})}setInterval(cleanupScrollData,24*60*60*1e3);