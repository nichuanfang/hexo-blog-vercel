$(document).ready(function(){if(document.querySelector(".movie-culture-list")){const l=300;const r=200;let t=1;const m=12;const u="https://api.chuanfang.org/trakt/movie";const p="https://image.tmdb.org/t/p/w116_and_h174_face";let e=sessionStorage.getItem("movie_init_data")||"";let a=false;const h=document.querySelector(".movie-culture-list");const f=document.getElementById("loading");if(e){sessionStorage.removeItem("movie_init_data");c(JSON.parse(e))}else{o(t,m)}function i(){f.style.display="block"}function d(){f.style.display="none"}function v(e){let t=parseFloat(e)/2;if(t>4.3)t=5;const a=parseInt(t);const n=t-a;const i=5-a-Math.ceil(n);return["★".repeat(a)+"☆".repeat(n),"☆".repeat(i)]}function o(e,t){fetch(`${u}?page=${e}&page_size=${t}`).then(e=>e.json()).then(e=>{if(e["data"]["data"].length===0){d();a=true}else{s(e,p);d();window.dispatchEvent(new CustomEvent("contentLoaded"))}}).catch(e=>console.error("Error:",e))}function s(e,f){const t=e["data"]["data"];const g=document.createDocumentFragment();t.forEach(e=>{const t=document.createElement("div");t.classList.add("media");if(e.share_link==="")t.style.opacity="0.5";const a=document.createElement("div");a.classList.add("media-cover");const n=document.createElement("img");n.setAttribute("src",f+e.cover_image_url);n.setAttribute("data-src",f+e.cover_image_url);n.setAttribute("data-loaded","true");n.setAttribute("lazyload","");n.setAttribute("srcset","/img/loading.gif");a.appendChild(n);const i=document.createElement("a");i.setAttribute("target","_blank");i.classList.add("media-cover-link");i.setAttribute("href",`/culture/movies/detail/?tmdb_id=${e.movie_id}`);i.appendChild(a);t.appendChild(i);const d=document.createElement("div");d.classList.add("media-meta");const o=document.createElement("div");o.classList.add("media-meta-item","title");const s=document.createElement("a");s.classList.add("title-link");s.setAttribute("target","_blank");s.setAttribute("href",`/culture/movies/detail/?tmdb_id=${e.movie_id}`);s.textContent=e.movie_name;o.appendChild(s);d.appendChild(o);const c=document.createElement("div");c.classList.add("media-meta-item");const l=document.createElement("span");l.classList.add("author");l.textContent=`${e.area} ${e.release_year}`;c.appendChild(l);const r=document.createElement("span");r.classList.add("star-score");const[m,u]=v(e.rating);r.textContent=m;const p=document.createElement("span");p.classList.add("grey-star");p.textContent=u;r.appendChild(p);c.appendChild(r);d.appendChild(c);const h=document.createElement("div");h.classList.add("media-meta-item","intro");h.textContent=e.movie_description;d.appendChild(h);t.appendChild(d);g.appendChild(t)});h.appendChild(g);document.querySelectorAll("img[lazyload]").forEach(e=>{Fluid.utils.waitElementVisible(e,()=>{e.removeAttribute("srcset");e.removeAttribute("lazyload")},CONFIG.lazyload.offset_factor)})}function c(e){if(e["data"]["data"].length===0){d();a=true}else{s(e,p)}}let n=null;window.addEventListener("scroll",()=>{if(a){d();return}clearTimeout(n);const e=document.documentElement.scrollHeight-window.innerHeight-window.scrollY;if(e<=r){i();n=setTimeout(()=>{t++;if(!a)o(t,m)},l)}})}});