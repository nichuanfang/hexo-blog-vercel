$(document).ready(function(){if(document.querySelector(".movie-culture-list")){const r=300;const m=200;let t=1;const u=12;const p="https://api.chuanfang.org/trakt/movie";const f="https://image.tmdb.org/t/p/w116_and_h174_face";let e=localStorage.getItem("movie_init_data")||"";let o=false;const v=document.querySelector(".movie-culture-list");const h=document.getElementById("loading");if(e){localStorage.removeItem("movie_init_data");d(JSON.parse(e))}else{s(t,u)}function i(){h.style.display="block"}function n(){h.style.display="none"}function _(e){let t=parseFloat(e)/2;if(t>4.3)t=5;const o=parseInt(t);const a=t-o;const i=5-o-Math.ceil(a);return["★".repeat(o)+"☆".repeat(a),"☆".repeat(i)]}function s(e,t){fetch(`${p}?page=${e}&page_size=${t}`).then(e=>e.json()).then(e=>{if(e["data"]["data"].length===0){n();o=true}else{l(e,f);n()}}).catch(e=>console.error("Error:",e))}function l(e,h){const t=e["data"]["data"];const g=document.createDocumentFragment();t.forEach(e=>{const t=document.createElement("div");t.classList.add("media");if(e.share_link==="")t.style.opacity="0.5";const o=document.createElement("div");o.classList.add("media-cover");const a=document.createElement("img");a.setAttribute("src",h+e.cover_image_url);a.setAttribute("data-src",h+e.cover_image_url);a.setAttribute("data-loaded","true");a.setAttribute("lazyload","");a.setAttribute("srcset","/img/loading.gif");o.appendChild(a);const i=document.createElement("a");i.setAttribute("target","_blank");i.classList.add("media-cover-link");i.setAttribute("href",`/culture/movies/detail/?tmdb_id=${e.movie_id}`);i.appendChild(o);t.appendChild(i);const n=document.createElement("div");n.classList.add("media-meta");const s=document.createElement("div");s.classList.add("media-meta-item","title");const l=document.createElement("a");l.classList.add("title-link");l.setAttribute("target","_blank");l.setAttribute("href",`/culture/movies/detail/?tmdb_id=${e.movie_id}`);l.textContent=e.movie_name;s.appendChild(l);n.appendChild(s);const d=document.createElement("div");d.classList.add("media-meta-item");const c=document.createElement("span");c.classList.add("author");c.textContent=`${e.area} ${e.release_year}`;d.appendChild(c);const r=document.createElement("span");r.classList.add("star-score");const[m,u]=_(e.rating);r.textContent=m;const p=document.createElement("span");p.classList.add("grey-star");p.textContent=u;r.appendChild(p);d.appendChild(r);n.appendChild(d);const f=document.createElement("div");f.classList.add("media-meta-item","intro");f.textContent=e.movie_description;n.appendChild(f);t.appendChild(n);g.appendChild(t)});v.appendChild(g);c();document.querySelectorAll("img[lazyload]").forEach(e=>{Fluid.utils.waitElementVisible(e,()=>{e.removeAttribute("srcset");e.removeAttribute("lazyload")},CONFIG.lazyload.offset_factor)})}function d(e){if(e["data"]["data"].length===0){n();o=true}else{l(e,f)}}function c(){const e=localStorage.getItem("fluid_scroll_position");if(e){try{const{position:t,timestamp:o}=JSON.parse(e);if(Date.now()-o<24*60*60*1e3){setTimeout(()=>{if(document.documentElement.scrollHeight>t){requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"auto"})});localStorage.removeItem("fluid_scroll_position")}},500)}else{localStorage.removeItem("fluid_scroll_position")}}catch(e){localStorage.removeItem("fluid_scroll_position")}}}let a=null;window.addEventListener("scroll",()=>{if(o){n();return}clearTimeout(a);const e=document.documentElement.scrollHeight-window.innerHeight-window.scrollY;if(e<=m){i();a=setTimeout(()=>{t++;if(!o)s(t,u)},r)}});const g=new MutationObserver(e=>{const t=e.some(e=>e.type==="childList"&&e.addedNodes.length>0);if(t){c()}});g.observe(v,{childList:true,subtree:true});window.addEventListener("beforeunload",()=>{const e={position:window.scrollY,timestamp:Date.now()};localStorage.setItem("fluid_scroll_position",JSON.stringify(e))})}});