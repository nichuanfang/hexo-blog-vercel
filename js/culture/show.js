$(document).ready(function(){if(document.querySelector(".show-culture-list")){const m=300;const u=200;let t=1;const p=12;const h="https://api.jaychou.site/trakt/show";const f="https://image.tmdb.org/t/p/w116_and_h174_face";let n=sessionStorage.getItem("show_init_data")||"";sessionStorage.removeItem("show_init_data");let o=null;let s=false;const g=document.querySelector(".show-culture-list");function a(){document.getElementById("loading").style.display="block"}function i(){document.getElementById("loading").style.display="none"}function w(e){let t=parseFloat(e)/2;if(t>4.3)t=5;const n=parseInt(t);const o=t-n;const s=5-n-Math.ceil(o);return["★".repeat(n)+"☆".repeat(o),"☆".repeat(s)]}function c(e,t){const n=`${h}?page=${e}&page_size=${t}`;return fetch(n).then(e=>e.json()).then(e=>{if(e["data"]["data"].length===0){i();s=true}else{d(e,f);i()}}).catch(e=>console.error("Error:",e))}function d(e,f){const t=e["data"]["data"];const n=document.querySelector(".show-culture-list");const g=document.createDocumentFragment();t.forEach(e=>{const t=document.createElement("div");t.classList.add("media");if(e.share_link==="")t.style.opacity="0.5";const n=document.createElement("div");n.classList.add("media-cover");const o=document.createElement("img");o.setAttribute("src",f+e.cover_image_url);o.setAttribute("data-src",f+e.cover_image_url);o.setAttribute("data-loaded","true");o.setAttribute("lazyload","");o.setAttribute("srcset","/img/loading.gif");n.appendChild(o);const s=document.createElement("a");s.classList.add("media-cover-link");s.setAttribute("href",`/culture/shows/detail/?tmdb_id=${e.show_id}`);s.appendChild(n);t.appendChild(s);const a=document.createElement("div");a.classList.add("media-meta");const i=document.createElement("div");i.classList.add("media-meta-item","title");const c=document.createElement("a");c.classList.add("title-link");c.setAttribute("href",`/culture/shows/detail/?tmdb_id=${e.show_id}`);c.textContent=e.show_name;i.appendChild(c);a.appendChild(i);const d=document.createElement("div");d.classList.add("media-meta-item");const l=document.createElement("span");l.classList.add("author");l.textContent=`${e.area} ${e.release_year}`;d.appendChild(l);const r=document.createElement("span");r.classList.add("star-score");const[m,u]=w(e.rating);r.textContent=m;const p=document.createElement("span");p.classList.add("grey-star");p.textContent=u;r.appendChild(p);d.appendChild(r);a.appendChild(d);const h=document.createElement("div");h.classList.add("media-meta-item","intro");h.textContent=e.show_description;a.appendChild(h);t.appendChild(a);g.appendChild(t)});n.appendChild(g);document.querySelectorAll("img[lazyload]").forEach(e=>{Fluid.utils.waitElementVisible(e,()=>{e.removeAttribute("srcset");e.removeAttribute("lazyload")},CONFIG.lazyload.offset_factor)})}function e(e){return new Promise((e,t)=>{setTimeout(()=>e({data:"模拟的异步数据"}),0)})}if(n!==""){e("https://api.example.com/data").then(e=>{const t=JSON.parse(n);if(t["data"]["data"].length===0){i();s=true}else{d(t,f)}}).catch(e=>console.error("Error:",e))}else{c(t,p)}window.addEventListener("scroll",()=>{if(s){i();return}clearTimeout(o);const e=document.documentElement.scrollHeight-window.innerHeight-window.scrollY;if(e<=u){a();o=setTimeout(()=>{t++;if(!s){c(t,p)}},m)}});function l(){sessionStorage.setItem("scrollPosition",window.scrollY)}function r(){const e=sessionStorage.getItem("scrollPosition");if(e){window.scrollTo(0,parseInt(e));sessionStorage.removeItem("scrollPosition")}}window.addEventListener("popstate",r);document.querySelectorAll(".media-cover-link, .title-link").forEach(e=>{e.addEventListener("click",l)})}});